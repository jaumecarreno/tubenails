export type Language = 'en' | 'es' | 'fr' | 'de' | 'zh' | 'ja';
export type TranslateVariables = Record<string, string | number>;

type TranslationMap = Record<string, string>;

export const DEFAULT_LANGUAGE: Language = 'en';
export const LANGUAGE_STORAGE_KEY = 'app-language';

export const SUPPORTED_LANGUAGES: Array<{ code: Language; label: string }> = [
    { code: 'en', label: 'English' },
    { code: 'es', label: 'Español' },
    { code: 'fr', label: 'Français' },
    { code: 'de', label: 'Deutsch' },
    { code: 'zh', label: '中文' },
    { code: 'ja', label: '日本語' }
];

export const LANGUAGE_TO_LOCALE: Record<Language, string> = {
    en: 'en-US',
    es: 'es-ES',
    fr: 'fr-FR',
    de: 'de-DE',
    zh: 'zh-CN',
    ja: 'ja-JP'
};

export function isLanguage(value: string | null | undefined): value is Language {
    return value === 'en' || value === 'es' || value === 'fr' || value === 'de' || value === 'zh' || value === 'ja';
}

const EN_TRANSLATIONS: TranslationMap = {
    'common.language': 'Language',

    'layout.nav.dashboard': 'Dashboard',
    'layout.nav.newTest': 'New Test',
    'layout.nav.settings': 'Settings',
    'layout.profile.userFallback': 'User',
    'layout.profile.logout': 'Log out',

    'login.title': 'Welcome to CTR Sniper',
    'login.subtitle': 'Sign in to automate your A/B tests and discover which thumbnails drive more views.',
    'login.connecting': 'Connecting...',
    'login.google': 'Continue with Google',
    'login.terms': 'By signing in, you agree to our Terms of Service and Privacy Policy.',
    'login.errorGoogle': 'Error signing in with Google.',

    'dashboard.title': 'Dashboard',
    'dashboard.createNewTest': 'Create New Test',
    'dashboard.loading': 'Loading API data...',
    'dashboard.metrics.activeTests': 'Active Tests',
    'dashboard.metrics.avgCtrLift': 'Average CTR Lift',
    'dashboard.metrics.watchTimeLift': 'Watch-Time Lift',
    'dashboard.metrics.extraClicks': 'Extra Clicks',
    'dashboard.metrics.extraWatchMinutes': 'Extra Watch Minutes',
    'dashboard.metrics.inconclusiveTests': 'Inconclusive Tests',
    'dashboard.activeSection': 'Active A/B Tests',
    'dashboard.noActiveTests': 'No active tests right now.',
    'dashboard.running': 'Running',
    'dashboard.started': 'Started: {date}',
    'dashboard.controlA': 'Control (A)',
    'dashboard.variantB': 'Variant (B)',
    'dashboard.viewAnalytics': 'View Detailed Analytics ->',

    'new.backToDashboard': 'Back to Dashboard',
    'new.title': 'Set Up New A/B Test',
    'new.subtitle': 'Compare thumbnails and titles to improve CTR.',
    'new.step.video': 'Which video do you want to optimize?',
    'new.videoPlaceholder': 'Paste video URL or ID',
    'new.import': 'Import',
    'new.latestVideos': 'Your latest videos',
    'new.loadingCatalog': 'Loading catalog...',
    'new.selected': 'SELECTED',
    'new.noVideos': 'No videos available',
    'new.noVideosHint': 'Connect your YouTube account to import recent videos.',
    'new.goSettings': 'Go to Settings',
    'new.step.variants': 'Define your variants',
    'new.variantA': 'Variant A (Control)',
    'new.variantB': 'Variant B (Test)',
    'new.readOnly': 'Read-only',
    'new.editable': 'Editable',
    'new.videoTitle': 'Video title',
    'new.uploadTitle': 'Upload variant B thumbnail',
    'new.uploadHint': 'Drop an image here or use the button (PNG/JPG/WEBP, max 2MB).',
    'new.uploadButton': 'Upload image',
    'new.thumbnailUrl': 'Or paste thumbnail URL',
    'new.thumbnailUrlPlaceholder': 'https://example.com/image.jpg',
    'new.newTitle': 'New title (optional)',
    'new.newTitlePlaceholder': 'Write an alternate title...',
    'new.step.duration': 'Test duration',
    'new.days': 'Days',
    'new.rotation': 'Rotation methodology',
    'new.rotationHint': 'The system rotates thumbnail and title every 24h at 00:01 PT to keep exposure balanced.',
    'new.start': 'Start A/B Test Now',
    'new.creating': 'Creating DB Test...',
    'new.alertSelectVideo': 'Select a video or paste a valid ID before continuing.',
    'new.alertThumbnail': 'Upload or paste a thumbnail for variant B.',
    'new.alertCreateFailed': 'Could not create A/B test.',
    'new.errorUnknown': 'Unknown error while creating test.',
    'new.errorFileRead': 'Could not read file',
    'new.errorImportVideo': 'Could not fetch video from YouTube. Check the ID and your connection.',
    'new.errorInvalidFormat': 'Invalid format. Use PNG, JPG/JPEG or WEBP.',
    'new.errorFileTooLarge': 'Image exceeds 2MB. Use a smaller file.',
    'new.errorReadImage': 'Could not process the selected image.',
    'new.errorImageTooHeavy': 'Image is too large to send. Use a smaller one.',

    'settings.loading': 'Loading profile...',
    'settings.backToDashboard': 'Back to Dashboard',
    'settings.title': 'Account Settings',
    'settings.subtitle': 'Manage your YouTube connection, billing and preferences.',
    'settings.youtube': 'YouTube Connection',
    'settings.connected': 'Connected',
    'settings.disconnected': 'Disconnected',
    'settings.userFallback': 'CTR Sniper user',
    'settings.authorized': 'CTR Sniper is authorized to update YouTube titles and thumbnails for your tests.',
    'settings.myChannel': 'My Channel',
    'settings.disconnectChannel': 'Disconnect Channel',
    'settings.connectHint': 'Connect your channel to run automatic test rotations.',
    'settings.connectYoutube': 'Connect YouTube',
    'settings.subscription': 'Subscription',
    'settings.currentPlan': 'Current plan',
    'settings.plan.basic': 'Basic (Free)',
    'settings.plan.premium': 'Premium',
    'settings.plan.teams': 'Teams',
    'settings.plan.pro': 'Pro',
    'settings.usage': 'A/B test usage',
    'settings.usageOf': '{used} of {limit}',
    'settings.activeNow': '{count} active tests right now.',
    'settings.errorConnect': 'Could not start YouTube OAuth flow: {message}',
    'settings.errorDisconnect': 'Error disconnecting account. Check console for details.',

    'team.title': 'Team Collaboration',
    'team.workspaceLabel': 'Workspace',
    'team.seats': 'Seats',
    'team.collaborationDisabled': 'Team features are available on Premium and Teams plans.',
    'team.invite': 'Invite teammate',
    'team.inviteEmailPlaceholder': 'teammate@email.com',
    'team.sendInvite': 'Create invite link',
    'team.pendingInvites': 'Pending invites',
    'team.noPendingInvites': 'No pending invites.',
    'team.cancelInvite': 'Cancel invite',
    'team.members': 'Members',
    'team.noMembers': 'No members found.',
    'team.memberSince': 'Member since',
    'team.removeMember': 'Remove',
    'team.expiresAt': 'Expires',
    'team.copySuccess': 'Invite link copied to clipboard.',
    'team.copyFallback': 'Copy this invite link manually:',
    'team.processingInvite': 'Processing invite token...',
    'team.inviteAccepted': 'Invite accepted. Workspace switched.',
    'team.inviteAcceptFailed': 'Could not accept invite',
    'team.errorInviteCreate': 'Could not create invite',
    'team.errorInviteCancel': 'Could not cancel invite',
    'team.errorMemberRole': 'Could not update member role',
    'team.errorMemberRemove': 'Could not remove member',
    'team.onlyOwnerCanConnectYoutube': 'Only workspace owner can connect or disconnect YouTube.',
    'team.role.owner': 'Owner',
    'team.role.admin': 'Admin',
    'team.role.member': 'Member',

    'results.loading': 'Loading results...',
    'results.notFound': 'Test not found or API error.',
    'results.backToDashboard': 'Back to Dashboard',
    'results.videoFallback': 'Video Test',
    'results.status': 'Status',
    'results.finished': 'Finished',
    'results.running': 'Running',
    'results.confidence': 'Confidence',
    'results.collectingData': 'Collecting data',
    'results.collectingHint': 'Rotation executes daily at 00:01 PT. Winner decision remains pending.',
    'results.variantSelected': 'Variant {variant} selected',
    'results.winnerModeReason': 'Winner mode: {mode}. Reason: {reason}.',
    'results.inconclusive': 'Inconclusive test',
    'results.inconclusiveHint': 'Auto-win criteria not met. Choose a variant manually to close with override.',
    'results.scoreDelta': 'Score Delta',
    'results.ctrDelta': 'CTR Delta',
    'results.pValue': 'P-Value',
    'results.daysRemaining': 'Days Remaining',
    'results.sync': 'Sync Latest Analytics',
    'results.syncing': 'Synchronizing...',
    'results.applyA': 'Apply Manual A',
    'results.applyB': 'Apply Manual B',
    'results.applyingA': 'Applying A...',
    'results.applyingB': 'Applying B...',
    'results.decisionReason': 'Decision Reason',
    'results.winner': 'Winner',
    'results.metric.ctr': 'CTR',
    'results.metric.score': 'Score',
    'results.metric.impressions': 'Impressions',
    'results.metric.estimatedClicks': 'Estimated Clicks',
    'results.metric.watchMinutes': 'Watch Minutes',
    'results.metric.wtpi': 'WTPI',
    'results.confidence.high': 'High',
    'results.confidence.medium': 'Medium',
    'results.confidence.low': 'Low',
    'results.na': 'N/A',
    'results.noReason': 'No reason provided',
    'results.errorUnexpected': 'Unexpected API error',
    'results.errorSync': 'Could not synchronize analytics: {message}',
    'results.errorApply': 'Could not apply variant {variant}: {message}',
    'results.reason.auto_criteria_met': 'Auto criteria met',
    'results.reason.manual_override': 'Manual winner applied',
    'results.reason.test_in_progress': 'Test still running',
    'results.reason.criteria_met_waiting_test_end': 'Criteria met but waiting for test end',
    'results.reason.insufficient_exposure_days': 'Not enough exposure days',
    'results.reason.insufficient_impressions': 'Not enough impressions',
    'results.reason.insufficient_confidence': 'Confidence below threshold',
    'results.reason.insufficient_ctr_delta': 'CTR delta below threshold',
    'results.reason.insufficient_score_delta': 'Score delta below threshold'
};

const ES_TRANSLATIONS: TranslationMap = {
    'common.language': 'Idioma',
    'layout.nav.dashboard': 'Panel',
    'layout.nav.newTest': 'Nuevo test',
    'layout.nav.settings': 'Ajustes',
    'layout.profile.userFallback': 'Usuario',
    'layout.profile.logout': 'Cerrar sesión',
    'login.title': 'Bienvenido a CTR Sniper',
    'login.subtitle': 'Inicia sesión para automatizar tus tests A/B y descubrir qué miniaturas generan más visualizaciones.',
    'login.connecting': 'Conectando...',
    'login.google': 'Entrar con Google',
    'login.terms': 'Al iniciar sesión aceptas nuestros Términos de Servicio y la Política de Privacidad.',
    'dashboard.title': 'Panel',
    'dashboard.createNewTest': 'Crear nuevo test',
    'dashboard.loading': 'Cargando datos de la API...',
    'dashboard.metrics.activeTests': 'Tests activos',
    'dashboard.metrics.avgCtrLift': 'Mejora media de CTR',
    'dashboard.metrics.watchTimeLift': 'Mejora de tiempo de visualización',
    'dashboard.metrics.extraClicks': 'Clics extra',
    'dashboard.metrics.extraWatchMinutes': 'Minutos extra vistos',
    'dashboard.metrics.inconclusiveTests': 'Tests inconclusos',
    'dashboard.activeSection': 'Tests A/B activos',
    'dashboard.noActiveTests': 'No hay tests activos ahora mismo.',
    'dashboard.running': 'En curso',
    'dashboard.started': 'Inicio: {date}',
    'dashboard.controlA': 'Control (A)',
    'dashboard.variantB': 'Variante (B)',
    'dashboard.viewAnalytics': 'Ver analíticas detalladas ->',
    'new.backToDashboard': 'Volver al panel',
    'new.title': 'Configurar nuevo test A/B',
    'new.subtitle': 'Compara miniaturas y títulos para mejorar CTR.',
    'new.step.video': '¿Qué video quieres optimizar?',
    'new.videoPlaceholder': 'Pega URL o ID del video',
    'new.import': 'Importar',
    'new.latestVideos': 'Tus últimos videos',
    'new.loadingCatalog': 'Cargando catálogo...',
    'new.selected': 'SELECCIONADO',
    'new.noVideos': 'No hay videos disponibles',
    'new.noVideosHint': 'Conecta tu cuenta de YouTube para importar videos recientes.',
    'new.goSettings': 'Ir a ajustes',
    'new.step.variants': 'Define tus variantes',
    'new.variantA': 'Variante A (Control)',
    'new.variantB': 'Variante B (Test)',
    'new.readOnly': 'Solo lectura',
    'new.editable': 'Editable',
    'new.videoTitle': 'Título del video',
    'new.uploadTitle': 'Sube miniatura variante B',
    'new.uploadHint': 'Arrastra una imagen aquí o usa el botón (PNG/JPG/WEBP, máx 2MB).',
    'new.uploadButton': 'Subir imagen',
    'new.thumbnailUrl': 'O pega URL de miniatura',
    'new.thumbnailUrlPlaceholder': 'https://ejemplo.com/imagen.jpg',
    'new.newTitle': 'Nuevo título (opcional)',
    'new.newTitlePlaceholder': 'Escribe un título alternativo...',
    'new.step.duration': 'Duración del test',
    'new.days': 'Días',
    'new.rotation': 'Metodología de rotación',
    'new.rotationHint': 'El sistema rota miniatura y título cada 24h a las 00:01 PT para mantener exposición homogénea.',
    'new.start': 'Iniciar test A/B ahora',
    'new.creating': 'Creando test en BD...',
    'new.alertSelectVideo': 'Selecciona un video o pega un ID válido antes de continuar.',
    'new.alertThumbnail': 'Sube o pega una miniatura para la variante B.',
    'new.alertCreateFailed': 'No se pudo crear el test A/B.',
    'new.errorImageTooHeavy': 'La imagen es demasiado pesada para enviarse. Usa una más pequeña.',
    'new.errorUnknown': 'Error desconocido al crear el test.',
    'new.errorImportVideo': 'No se pudo descargar el video de YouTube. Revisa el ID y la conexión.',
    'new.errorInvalidFormat': 'Formato no válido. Usa PNG, JPG/JPEG o WEBP.',
    'new.errorFileTooLarge': 'La imagen supera 2MB. Usa un archivo más pequeño.',
    'new.errorReadImage': 'No se pudo procesar la imagen seleccionada.',
    'settings.loading': 'Cargando perfil...',
    'settings.backToDashboard': 'Volver al panel',
    'settings.title': 'Ajustes de cuenta',
    'settings.subtitle': 'Gestiona tu conexión con YouTube, facturación y preferencias.',
    'settings.youtube': 'Conexión con YouTube',
    'settings.connected': 'Conectado',
    'settings.disconnected': 'Desconectado',
    'settings.userFallback': 'Usuario de CTR Sniper',
    'settings.authorized': 'CTR Sniper está autorizado para actualizar títulos y miniaturas de YouTube en tus tests.',
    'settings.myChannel': 'Mi canal',
    'settings.disconnectChannel': 'Desconectar canal',
    'settings.connectHint': 'Conecta tu canal para ejecutar rotaciones automáticas.',
    'settings.connectYoutube': 'Conectar YouTube',
    'settings.subscription': 'Suscripción',
    'settings.currentPlan': 'Plan actual',
    'settings.plan.basic': 'Básico (Gratis)',
    'settings.plan.pro': 'Pro',
    'settings.usage': 'Uso de tests A/B',
    'settings.usageOf': '{used} de {limit}',
    'settings.activeNow': '{count} tests activos ahora mismo.',
    'settings.errorConnect': 'No se pudo iniciar el flujo OAuth de YouTube: {message}',
    'settings.errorDisconnect': 'Error al desconectar la cuenta. Revisa la consola para más detalle.',
    'results.loading': 'Cargando resultados...',
    'results.notFound': 'Test no encontrado o error de API.',
    'results.backToDashboard': 'Volver al panel',
    'results.videoFallback': 'Test de video',
    'results.status': 'Estado',
    'results.finished': 'Finalizado',
    'results.running': 'En curso',
    'results.confidence': 'Confianza',
    'results.collectingData': 'Recolectando datos',
    'results.collectingHint': 'La rotación se ejecuta diariamente a las 00:01 PT. La decisión del ganador sigue pendiente.',
    'results.variantSelected': 'Variante {variant} seleccionada',
    'results.winnerModeReason': 'Modo de ganador: {mode}. Motivo: {reason}.',
    'results.inconclusive': 'Test inconcluso',
    'results.inconclusiveHint': 'No se cumplieron los criterios automáticos. Elige una variante manualmente para cerrar.',
    'results.scoreDelta': 'Delta de score',
    'results.ctrDelta': 'Delta de CTR',
    'results.pValue': 'Valor p',
    'results.daysRemaining': 'Días restantes',
    'results.sync': 'Sincronizar últimas analíticas',
    'results.syncing': 'Sincronizando...',
    'results.applyA': 'Aplicar A manual',
    'results.applyB': 'Aplicar B manual',
    'results.applyingA': 'Aplicando A...',
    'results.applyingB': 'Aplicando B...',
    'results.decisionReason': 'Motivo de decisión',
    'results.winner': 'Ganador',
    'results.metric.score': 'Score',
    'results.metric.impressions': 'Impresiones',
    'results.metric.estimatedClicks': 'Clics estimados',
    'results.metric.watchMinutes': 'Minutos vistos',
    'results.confidence.high': 'Alta',
    'results.confidence.medium': 'Media',
    'results.confidence.low': 'Baja',
    'results.noReason': 'Sin motivo',
    'results.errorUnexpected': 'Error inesperado de API',
    'results.errorSync': 'No se pudieron sincronizar analíticas: {message}',
    'results.errorApply': 'No se pudo aplicar la variante {variant}: {message}',
    'results.reason.auto_criteria_met': 'Criterio automático cumplido',
    'results.reason.manual_override': 'Ganador manual aplicado',
    'results.reason.test_in_progress': 'Test todavía en curso',
    'results.reason.criteria_met_waiting_test_end': 'Criterio cumplido pero esperando fin del test',
    'results.reason.insufficient_exposure_days': 'No hay suficientes días de exposición',
    'results.reason.insufficient_impressions': 'No hay suficientes impresiones',
    'results.reason.insufficient_confidence': 'Confianza por debajo del umbral',
    'results.reason.insufficient_ctr_delta': 'Delta de CTR por debajo del umbral',
    'results.reason.insufficient_score_delta': 'Delta de score por debajo del umbral'
};
const FR_TRANSLATIONS: TranslationMap = {
    'common.language': 'Langue',
    'layout.nav.dashboard': 'Tableau de bord',
    'layout.nav.newTest': 'Nouveau test',
    'layout.nav.settings': 'Paramètres',
    'layout.profile.userFallback': 'Utilisateur',
    'layout.profile.logout': 'Se déconnecter',
    'login.title': 'Bienvenue sur CTR Sniper',
    'login.subtitle': 'Connectez-vous pour automatiser vos tests A/B et découvrir quelles miniatures génèrent plus de vues.',
    'login.connecting': 'Connexion...',
    'login.google': 'Continuer avec Google',
    'dashboard.title': 'Tableau de bord',
    'dashboard.createNewTest': 'Créer un nouveau test',
    'dashboard.metrics.activeTests': 'Tests actifs',
    'dashboard.activeSection': 'Tests A/B actifs',
    'dashboard.noActiveTests': 'Aucun test actif pour le moment.',
    'new.backToDashboard': 'Retour au tableau de bord',
    'new.title': 'Configurer un nouveau test A/B',
    'new.subtitle': 'Comparez miniatures et titres pour améliorer le CTR.',
    'new.step.video': 'Quelle vidéo voulez-vous optimiser ?',
    'new.import': 'Importer',
    'new.selected': 'SÉLECTIONNÉ',
    'new.step.variants': 'Définissez vos variantes',
    'new.variantA': 'Variante A (Contrôle)',
    'new.variantB': 'Variante B (Test)',
    'new.step.duration': 'Durée du test',
    'new.start': 'Démarrer le test A/B',
    'settings.loading': 'Chargement du profil...',
    'settings.backToDashboard': 'Retour au tableau de bord',
    'settings.title': 'Paramètres du compte',
    'settings.subtitle': 'Gérez votre connexion YouTube, la facturation et vos préférences.',
    'settings.youtube': 'Connexion YouTube',
    'settings.connected': 'Connecté',
    'settings.disconnected': 'Déconnecté',
    'settings.connectYoutube': 'Connecter YouTube',
    'settings.subscription': 'Abonnement',
    'settings.currentPlan': 'Forfait actuel',
    'settings.plan.basic': 'Basique (Gratuit)',
    'settings.usage': 'Utilisation tests A/B',
    'settings.usageOf': '{used} sur {limit}',
    'settings.activeNow': '{count} tests actifs actuellement.',
    'results.loading': 'Chargement des résultats...',
    'results.notFound': 'Test introuvable ou erreur API.',
    'results.backToDashboard': 'Retour au tableau de bord',
    'results.status': 'Statut',
    'results.finished': 'Terminé',
    'results.running': 'En cours',
    'results.confidence': 'Confiance',
    'results.collectingData': 'Collecte des données',
    'results.inconclusive': 'Test non concluant',
    'results.scoreDelta': 'Delta score',
    'results.ctrDelta': 'Delta CTR',
    'results.daysRemaining': 'Jours restants',
    'results.sync': 'Synchroniser les analyses',
    'results.syncing': 'Synchronisation...',
    'results.applyA': 'Appliquer A manuellement',
    'results.applyB': 'Appliquer B manuellement',
    'results.decisionReason': 'Raison de la décision',
    'results.winner': 'Gagnant',
    'results.confidence.high': 'Élevée',
    'results.confidence.medium': 'Moyenne',
    'results.confidence.low': 'Faible'
};
const DE_TRANSLATIONS: TranslationMap = {
    'common.language': 'Sprache',
    'layout.nav.dashboard': 'Dashboard',
    'layout.nav.newTest': 'Neuer Test',
    'layout.nav.settings': 'Einstellungen',
    'layout.profile.userFallback': 'Benutzer',
    'layout.profile.logout': 'Abmelden',
    'login.title': 'Willkommen bei CTR Sniper',
    'login.subtitle': 'Melde dich an, um deine A/B-Tests zu automatisieren und bessere Thumbnails zu finden.',
    'login.connecting': 'Verbinden...',
    'login.google': 'Mit Google fortfahren',
    'dashboard.createNewTest': 'Neuen Test erstellen',
    'dashboard.metrics.activeTests': 'Aktive Tests',
    'dashboard.activeSection': 'Aktive A/B-Tests',
    'new.backToDashboard': 'Zurück zum Dashboard',
    'new.title': 'Neuen A/B-Test einrichten',
    'new.step.video': 'Welches Video möchtest du optimieren?',
    'new.import': 'Importieren',
    'new.selected': 'AUSGEWÄHLT',
    'new.step.variants': 'Varianten definieren',
    'new.variantA': 'Variante A (Kontrolle)',
    'new.variantB': 'Variante B (Test)',
    'new.step.duration': 'Testdauer',
    'new.start': 'A/B-Test jetzt starten',
    'settings.loading': 'Profil wird geladen...',
    'settings.backToDashboard': 'Zurück zum Dashboard',
    'settings.title': 'Kontoeinstellungen',
    'settings.subtitle': 'Verwalte deine YouTube-Verbindung, Abrechnung und Einstellungen.',
    'settings.youtube': 'YouTube-Verbindung',
    'settings.connected': 'Verbunden',
    'settings.disconnected': 'Getrennt',
    'settings.connectYoutube': 'YouTube verbinden',
    'settings.subscription': 'Abonnement',
    'settings.currentPlan': 'Aktueller Plan',
    'settings.plan.basic': 'Basis (Kostenlos)',
    'settings.usage': 'A/B-Test-Nutzung',
    'settings.usageOf': '{used} von {limit}',
    'settings.activeNow': '{count} aktive Tests aktuell.',
    'results.loading': 'Ergebnisse werden geladen...',
    'results.notFound': 'Test nicht gefunden oder API-Fehler.',
    'results.backToDashboard': 'Zurück zum Dashboard',
    'results.status': 'Status',
    'results.finished': 'Beendet',
    'results.running': 'Läuft',
    'results.confidence': 'Konfidenz',
    'results.collectingData': 'Daten werden gesammelt',
    'results.inconclusive': 'Unklarer Test',
    'results.scoreDelta': 'Score-Differenz',
    'results.ctrDelta': 'CTR-Differenz',
    'results.daysRemaining': 'Verbleibende Tage',
    'results.sync': 'Neueste Analysen synchronisieren',
    'results.syncing': 'Synchronisierung...',
    'results.applyA': 'A manuell anwenden',
    'results.applyB': 'B manuell anwenden',
    'results.decisionReason': 'Entscheidungsgrund',
    'results.winner': 'Gewinner',
    'results.confidence.high': 'Hoch',
    'results.confidence.medium': 'Mittel',
    'results.confidence.low': 'Niedrig'
};
const ZH_TRANSLATIONS: TranslationMap = {
    'common.language': '语言',
    'layout.nav.dashboard': '仪表盘',
    'layout.nav.newTest': '新建测试',
    'layout.nav.settings': '设置',
    'layout.profile.userFallback': '用户',
    'layout.profile.logout': '退出登录',
    'login.title': '欢迎使用 CTR Sniper',
    'login.subtitle': '登录后即可自动化 A/B 测试，找出更高表现的缩略图。',
    'login.connecting': '连接中...',
    'login.google': '使用 Google 继续',
    'dashboard.title': '仪表盘',
    'dashboard.createNewTest': '创建新测试',
    'dashboard.metrics.activeTests': '进行中的测试',
    'dashboard.activeSection': '进行中的 A/B 测试',
    'new.backToDashboard': '返回仪表盘',
    'new.title': '配置新的 A/B 测试',
    'new.step.video': '你想优化哪个视频？',
    'new.import': '导入',
    'new.selected': '已选择',
    'new.step.variants': '定义你的变体',
    'new.variantA': '变体 A（对照）',
    'new.variantB': '变体 B（测试）',
    'new.step.duration': '测试时长',
    'new.start': '立即开始 A/B 测试',
    'settings.loading': '正在加载资料...',
    'settings.backToDashboard': '返回仪表盘',
    'settings.title': '账户设置',
    'settings.subtitle': '管理你的 YouTube 连接、账单和偏好设置。',
    'settings.youtube': 'YouTube 连接',
    'settings.connected': '已连接',
    'settings.disconnected': '未连接',
    'settings.connectYoutube': '连接 YouTube',
    'settings.subscription': '订阅',
    'settings.currentPlan': '当前方案',
    'settings.plan.basic': '基础版（免费）',
    'settings.usage': 'A/B 测试用量',
    'settings.usageOf': '{used} / {limit}',
    'settings.activeNow': '当前有 {count} 个进行中的测试。',
    'results.loading': '正在加载结果...',
    'results.notFound': '未找到测试或 API 出错。',
    'results.backToDashboard': '返回仪表盘',
    'results.status': '状态',
    'results.finished': '已结束',
    'results.running': '进行中',
    'results.confidence': '置信度',
    'results.collectingData': '正在收集数据',
    'results.inconclusive': '测试无结论',
    'results.scoreDelta': '分数差值',
    'results.ctrDelta': 'CTR 差值',
    'results.daysRemaining': '剩余天数',
    'results.sync': '同步最新分析',
    'results.syncing': '同步中...',
    'results.applyA': '手动应用 A',
    'results.applyB': '手动应用 B',
    'results.decisionReason': '决策原因',
    'results.winner': '赢家',
    'results.confidence.high': '高',
    'results.confidence.medium': '中',
    'results.confidence.low': '低'
};
const JA_TRANSLATIONS: TranslationMap = {
    'common.language': '言語',
    'layout.nav.dashboard': 'ダッシュボード',
    'layout.nav.newTest': '新規テスト',
    'layout.nav.settings': '設定',
    'layout.profile.userFallback': 'ユーザー',
    'layout.profile.logout': 'ログアウト',
    'login.title': 'CTR Sniper へようこそ',
    'login.subtitle': 'ログインして A/B テストを自動化し、より効果的なサムネイルを見つけましょう。',
    'login.connecting': '接続中...',
    'login.google': 'Google で続行',
    'dashboard.title': 'ダッシュボード',
    'dashboard.createNewTest': '新しいテストを作成',
    'dashboard.metrics.activeTests': '進行中のテスト',
    'dashboard.activeSection': '進行中の A/B テスト',
    'new.backToDashboard': 'ダッシュボードへ戻る',
    'new.title': '新しい A/B テストを設定',
    'new.step.video': 'どの動画を最適化しますか？',
    'new.import': 'インポート',
    'new.selected': '選択済み',
    'new.step.variants': 'バリアントを定義',
    'new.variantA': 'バリアント A（コントロール）',
    'new.variantB': 'バリアント B（テスト）',
    'new.step.duration': 'テスト期間',
    'new.start': '今すぐ A/B テストを開始',
    'settings.loading': 'プロフィールを読み込み中...',
    'settings.backToDashboard': 'ダッシュボードへ戻る',
    'settings.title': 'アカウント設定',
    'settings.subtitle': 'YouTube 接続、請求、設定を管理します。',
    'settings.youtube': 'YouTube 接続',
    'settings.connected': '接続済み',
    'settings.disconnected': '未接続',
    'settings.connectYoutube': 'YouTube を接続',
    'settings.subscription': 'サブスクリプション',
    'settings.currentPlan': '現在のプラン',
    'settings.plan.basic': 'ベーシック（無料）',
    'settings.usage': 'A/B テスト使用量',
    'settings.usageOf': '{used} / {limit}',
    'settings.activeNow': '現在 {count} 件のアクティブテストがあります。',
    'results.loading': '結果を読み込み中...',
    'results.notFound': 'テストが見つからないか、API エラーです。',
    'results.backToDashboard': 'ダッシュボードへ戻る',
    'results.status': 'ステータス',
    'results.finished': '完了',
    'results.running': '進行中',
    'results.confidence': '信頼度',
    'results.collectingData': 'データ収集中',
    'results.inconclusive': '結論が出ないテスト',
    'results.scoreDelta': 'スコア差',
    'results.ctrDelta': 'CTR 差',
    'results.daysRemaining': '残り日数',
    'results.sync': '最新分析を同期',
    'results.syncing': '同期中...',
    'results.applyA': 'A を手動適用',
    'results.applyB': 'B を手動適用',
    'results.decisionReason': '判定理由',
    'results.winner': '勝者',
    'results.confidence.high': '高',
    'results.confidence.medium': '中',
    'results.confidence.low': '低'
};

const TRANSLATIONS: Record<Language, TranslationMap> = {
    en: EN_TRANSLATIONS,
    es: ES_TRANSLATIONS,
    fr: FR_TRANSLATIONS,
    de: DE_TRANSLATIONS,
    zh: ZH_TRANSLATIONS,
    ja: JA_TRANSLATIONS
};

function applyVariables(template: string, variables?: TranslateVariables): string {
    if (!variables) {
        return template;
    }

    return template.replace(/\{(\w+)\}/g, (_match, key: string) => {
        if (Object.prototype.hasOwnProperty.call(variables, key)) {
            return String(variables[key]);
        }
        return `{${key}}`;
    });
}

export function translate(language: Language, key: string, variables?: TranslateVariables): string {
    const template = TRANSLATIONS[language]?.[key] ?? EN_TRANSLATIONS[key] ?? key;
    return applyVariables(template, variables);
}
